---
name: Main Menu Implementation
status: open
created: 2025-09-03T18:46:59Z
updated: 2025-09-03T19:11:14Z
github: https://github.com/AngelOnFira/macroquad-mech-2025/issues/5
depends_on: [3]
parallel: true
conflicts_with: []
---

# Task 5: Main Menu Implementation

## Overview
Implement a terminal-style main menu using egui that integrates seamlessly with the existing game architecture. The menu should feel consistent with the game's aesthetic while providing intuitive navigation.

## Current State
- No menu system exists
- Game starts directly into gameplay
- All UI is currently in-game only

## Objective
Create a main menu that provides game entry point, settings access, and other core navigation, using a terminal/console aesthetic that matches the mech theme.

## Technical Requirements

### 1. Menu Structure
```rust
pub struct MainMenu {
    pub state: MenuState,
    pub selected_option: usize,
    pub animation_state: MenuAnimationState,
    pub terminal_text: TerminalDisplay,
}

#[derive(Debug, Clone, PartialEq)]
pub enum MenuState {
    Main,
    Settings,
    About,
    Quit,
}

pub struct TerminalDisplay {
    pub boot_sequence: Vec<String>,
    pub current_line: usize,
    pub typing_progress: f32,
    pub cursor_visible: bool,
}
```

### 2. Visual Design - Terminal Aesthetic
- **Color Scheme**: Green text on dark background (#00FF00 on #001100)
- **Typography**: Monospace font (Courier New or similar)
- **Effects**: 
  - Typing animation for menu text
  - Blinking cursor
  - Scan lines overlay
  - CRT-style glow effect

### 3. Menu Options
```rust
pub enum MenuOption {
    StartGame,
    Settings,
    Controls,
    About,
    Quit,
}

impl MenuOption {
    pub fn get_display_text(&self) -> &'static str {
        match self {
            MenuOption::StartGame => "> INITIALIZE MECH SYSTEMS",
            MenuOption::Settings => "> CONFIGURE PARAMETERS",
            MenuOption::Controls => "> CONTROL MAPPING",
            MenuOption::About => "> SYSTEM INFORMATION",
            MenuOption::Quit => "> SHUTDOWN SEQUENCE",
        }
    }
}
```

### 4. Navigation System
- **Keyboard**: Up/Down arrows, Enter to select, Escape to go back
- **Mouse**: Click to select, hover effects
- **Controller**: D-pad/stick navigation support

### 5. Integration with AppState
```rust
impl MainMenu {
    pub fn update(&mut self, app_state: &mut AppState, input: &InputState) -> MenuAction
    pub fn render(&self, egui_ctx: &egui::Context)
}

pub enum MenuAction {
    None,
    StartGame,
    OpenSettings,
    OpenControls,
    OpenAbout,
    Quit,
}
```

## Acceptance Criteria

1. **Main Menu Displays**: Clean terminal-style interface with all menu options
2. **Navigation Works**: Keyboard, mouse, and controller navigation function correctly
3. **Visual Polish**: Terminal aesthetic with typing animations and effects
4. **State Integration**: Seamlessly integrates with AppState from Task 3
5. **Responsive**: Menu adapts to different screen sizes appropriately
6. **Performance**: Smooth 60fps rendering with all effects enabled
7. **Accessibility**: Keyboard navigation works without mouse
8. **Audio Feedback**: Sound effects for navigation and selection (if audio system exists)

## Technical Details

### egui Integration
```rust
pub struct MenuRenderer {
    egui_ctx: egui::Context,
    style: MenuStyle,
    fonts: FontConfiguration,
}

impl MenuRenderer {
    pub fn render_main_menu(&mut self, menu: &MainMenu) {
        egui::CentralPanel::default().show(&self.egui_ctx, |ui| {
            self.render_terminal_background(ui);
            self.render_boot_sequence(ui, &menu.terminal_text);
            self.render_menu_options(ui, &menu);
            self.render_cursor(ui, menu.terminal_text.cursor_visible);
            self.render_scan_lines(ui);
        });
    }
}
```

### Terminal Boot Sequence
```rust
const BOOT_SEQUENCE: &[&str] = &[
    "MECH COMBAT SYSTEM v2.1.7",
    "Initializing neural interfaces...",
    "Loading weapon systems... OK",
    "Establishing team link... OK", 
    "Calibrating sensors... OK",
    "All systems operational",
    "",
    "MECH BATTLE ARENA",
    "Select operation:",
];
```

### Animation System
```rust
pub struct MenuAnimationState {
    pub boot_progress: f32,
    pub cursor_blink_timer: f32,
    pub selection_highlight: f32,
    pub scan_line_offset: f32,
}

impl MenuAnimationState {
    pub fn update(&mut self, delta: f32) {
        self.cursor_blink_timer = (self.cursor_blink_timer + delta) % 1.0;
        self.scan_line_offset = (self.scan_line_offset + delta * 50.0) % screen_height();
        
        if self.boot_progress < 1.0 {
            self.boot_progress += delta * 0.5; // 2 second boot sequence
        }
    }
}
```

### Style Configuration
```rust
pub struct MenuStyle {
    pub terminal_green: Color32,
    pub background_dark: Color32,
    pub selection_highlight: Color32,
    pub font_size: f32,
    pub line_spacing: f32,
    pub glow_intensity: f32,
}

impl Default for MenuStyle {
    fn default() -> Self {
        Self {
            terminal_green: Color32::from_rgb(0, 255, 0),
            background_dark: Color32::from_rgb(0, 17, 0),
            selection_highlight: Color32::from_rgb(0, 255, 100),
            font_size: 16.0,
            line_spacing: 1.2,
            glow_intensity: 0.3,
        }
    }
}
```

## Dependencies
- **egui**: UI framework (already in project dependencies)
- **egui_macroquad**: Integration layer with macroquad

## Effort Estimate
**4-5 hours**
- 1.5 hours: Basic menu structure and egui integration
- 1 hour: Terminal aesthetic styling and effects
- 1 hour: Navigation system implementation
- 1 hour: Animation system (typing, cursor, scan lines)
- 30 minutes: Testing and polish

## Files to Create
- **New file**: `client/src/menu/mod.rs` - Main menu module
- **New file**: `client/src/menu/main_menu.rs` - Core menu implementation
- **New file**: `client/src/menu/renderer.rs` - Menu rendering system
- **New file**: `client/src/menu/styles.rs` - Visual styling
- **New file**: `client/src/menu/animations.rs` - Animation system
- `client/src/lib.rs` - Add menu module

## Files to Modify
- `client/src/main.rs` - Integrate menu with main loop
- `client/src/app_state.rs` - Handle menu actions

## Testing Strategy
1. Unit tests for menu state management
2. Integration tests for AppState transitions
3. Visual tests for rendering (screenshot comparison)
4. Navigation tests for all input methods
5. Performance tests for smooth animation

## Integration Points
- **Task 3**: Uses AppState for menu/game transitions
- **Task 4**: Will integrate with settings system once available
- **Renderer**: Shares screen space with game renderer
- **Input**: Uses existing input handling system
- **Audio**: Will add audio feedback if available

## Risk Assessment
**Medium Risk** - egui integration with existing macroquad renderer may require careful coordination to avoid rendering conflicts.

## Visual Design Mockup

```
[Terminal-style screen with green text on dark background]

> MECH COMBAT SYSTEM v2.1.7
> Initializing neural interfaces...
> Loading weapon systems... OK
> Establishing team link... OK
> Calibrating sensors... OK  
> All systems operational
>
> MECH BATTLE ARENA
> Select operation:
>
> â–¶ INITIALIZE MECH SYSTEMS
>   CONFIGURE PARAMETERS
>   CONTROL MAPPING
>   SYSTEM INFORMATION
>   SHUTDOWN SEQUENCE
>
> _
```

## Notes
- Menu should feel like accessing a mech computer terminal
- Keep text brief and thematic
- Consider adding subtle sound effects for immersion
- Menu state should be preserved when returning from game
- Ensure menu works well on both desktop and web platforms

## Future Extensions
- Multiplayer lobby system
- Game statistics/leaderboards
- Mech customization preview
- Campaign/tutorial mode selection